<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ãƒãƒã¯ã²ã ã‚Šã‹ã‚‰æ•°ãˆã¦ãªã‚“ã°ã‚“ã‚ï¼Ÿ</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ctext y='50%25' x='50%25' dominant-baseline='central' text-anchor='middle' font-size='54'%3EğŸ™‹â€â™€ï¸%3C/text%3E%3C/svg%3E">
  <style>
    body{font-family:sans-serif;text-align:center;padding:20px 10px;background:#dcf0ff;width:100%;max-width:100%;margin:0 auto;box-sizing:border-box;}
    h1{font-size:18px;margin:5px 0;}
    #hero{font-size:80px;line-height:80px;height:80px;margin:0 auto 5px; overflow: hidden; text-align:center;}
    /* gameAreaã®æ ã‚’å®Œå…¨ã«æ¶ˆã™ */
    #gameArea{max-height:50vh; overflow-y:auto; -webkit-overflow-scrolling:touch; background:transparent; padding:0; margin:0; border:none; box-shadow:none; outline:none;}
    #line{display:flex;flex-direction:column;align-items:center;margin:5px auto;gap:2px;width:100%;max-width:100%;}
    .row{display:flex;justify-content:center;width:100%;margin-bottom:2px;}
    .person{display:inline-block;width:auto;height:auto;font-size:20px;margin:0 2px;cursor:default;user-select:none;line-height:1;background:transparent;}
    #timer{font-size:26px;font-weight:bold;margin:5px;visibility:hidden;}
    #score{margin:5px auto 15px;font-weight:bold;font-size:20px;text-align:center;width:100%;}
    #options{display:flex;justify-content:center;gap:8px;margin-top:8px;flex-wrap:wrap;}
    .optBtn{padding:12px 24px;font-size:20px;border:none;border-radius:8px;background:#2196f3;color:#fff;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.2);}    
    .optBtn:active{background:#1976D2;}
    #startBtn{padding:15px 30px;font-size:22px;border:none;border-radius:10px;background:#0066cc;color:#fff;cursor:pointer;box-shadow:0 3px 6px rgba(0,0,0,.3);-webkit-appearance:none;}    
    #startBtn:active{background:#0055aa;}  
    #ranking{margin-top:30px;text-align:left;padding-left:20px;padding-right:20px;}
    #ranking h2{font-size:22px;margin-bottom:6px;}
    #leaderboard{padding-left:40px;}
    #resetBtn{margin-left:20px;margin-top:10px;padding:6px 16px;font-size:14px;background:#e53935;color:white;border:none;border-radius:6px;cursor:pointer;}
    #nameInputContainer{margin-top:20px; display:none;}
    #nameInputContainer input[type="text"]{padding:10px;font-size:18px;border:1px solid #ccc; border-radius:5px; margin-right:10px;}
    #nameInputContainer button{padding:10px 20px;font-size:18px;border:none;border-radius:5px;background:#2196f3;color:#fff;cursor:pointer;}
    #nameInputContainer button:hover{filter:brightness(1.1);}
    #storeContainer{margin:20px auto; max-width:300px; display:none;}
    #remainingPlays{font-size:14px; color:#666; margin:5px 0;}
    #purchaseBtn{padding:12px 25px; background:#4CAF50; color:white; border:none; border-radius:8px; margin:10px auto; font-size:16px; display:block; cursor:pointer;}
    #restoreBtn{padding:8px 15px; background:#90CAF9; color:black; border:none; border-radius:6px; margin:5px auto; font-size:14px; display:block; cursor:pointer;}
  </style>
</head>
<body>
<div style="max-width:360px; margin:0 auto;">
  <h1>ãƒãƒã¯ã²ã ã‚Šã‹ã‚‰æ•°ãˆã¦ãªã‚“ã°ã‚“ã‚ï¼Ÿ</h1>
  <div id="hero" aria-label="æŒ™æ‰‹ã™ã‚‹å¥³æ€§" style="margin-top:60px;">ğŸ™‹â€â™€ï¸</div>
  <div id="score">ã‚¹ã‚³ã‚¢: 0</div>
  <div id="timer">ã®ã“ã‚Šã˜ã‹ã‚“ 0ç§’</div>
  <!-- gameAreaã‚’ç›´æ¥ã€è£…é£¾ãªã—ã®divã¨ã—ã¦è¡¨ç¤º -->
  <div id="line"></div>
  <div id="options"></div>
  <button id="startBtn" style="margin-top:15px;">START</button>
  
  <div id="storeContainer">
    <div id="remainingPlays"></div>
    <button id="purchaseBtn">åºƒå‘Šéè¡¨ç¤ºã‚’è³¼å…¥ ($1)</button>
    <button id="restoreBtn">è³¼å…¥ã‚’å¾©å…ƒ</button>
  </div>
</div>

<div id="nameInputContainer">
  <p>ãƒã‚¤ã‚¹ã‚³ã‚¢ï¼åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:</p>
  <input type="text" id="playerNameInput" placeholder="ãªã¾ãˆ">
  <button id="submitNameBtn">ç™»éŒ²</button>
</div>

<section id="ranking">
  <h2>ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
  <ol id="leaderboard"></ol>
  <button id="resetBtn">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
</section>

<script>
(() => {
  const startBtn = document.getElementById('startBtn');
  const timerEl = document.getElementById('timer');
  const scoreEl = document.getElementById('score');
  const lineEl = document.getElementById('line');
  const optionsEl = document.getElementById('options');
  const nameInputContainer = document.getElementById('nameInputContainer');
  const playerNameInput = document.getElementById('playerNameInput');
  const submitNameBtn = document.getElementById('submitNameBtn');
  const lbList = document.getElementById('leaderboard');
  const storeContainer = document.getElementById('storeContainer');
  const remainingPlays = document.getElementById('remainingPlays');
  const purchaseBtn = document.getElementById('purchaseBtn');
  const restoreBtn = document.getElementById('restoreBtn');

  let score = 0;
  let peopleNum = 8;
  let targetIndex = 0;
  let timeLeft = 10;
  let timerId;
  let reactTimes = [];
  let gameActive = false; // ã‚²ãƒ¼ãƒ ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°
  let startButtonClicked = false; // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°
  const LB_KEY = 'mama_leaderboard';
  const LASTNAME_KEY = 'mama_last_name';

  // ãƒã‚¤ãƒ†ã‚£ãƒ–å´ã®éŸ³å£°å†ç”Ÿé–¢æ•°å‘¼ã³å‡ºã—
  const play = (audio) => {
    // ã‚²ãƒ¼ãƒ ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§ãªã„å ´åˆã¯éŸ³ã‚’é³´ã‚‰ã•ãªã„
    if (!gameActive && audio === wrongAudio) return;
    
    try {
      if (audio === correctAudio) {
        console.log("æ­£è§£éŸ³ã‚’å†ç”Ÿã™ã‚‹ã‚ˆã†è¦æ±‚");
        try {
          if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.playCorrect) {
            window.webkit.messageHandlers.playCorrect.postMessage('play');
            console.log("æ­£è§£éŸ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æˆåŠŸ");
          } else {
            console.log("æ­£è§£éŸ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ³ãƒ‰ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
          }
        } catch (e) {
          console.log("æ­£è§£éŸ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒ©ãƒ¼:", e);
        }
      } else if (audio === wrongAudio) {
        console.log("ä¸æ­£è§£éŸ³ã‚’å†ç”Ÿã™ã‚‹ã‚ˆã†è¦æ±‚");
        try {
          if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.playWrong) {
            window.webkit.messageHandlers.playWrong.postMessage('play');
            console.log("ä¸æ­£è§£éŸ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æˆåŠŸ");
          } else {
            console.log("ä¸æ­£è§£éŸ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ³ãƒ‰ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
          }
        } catch (e) {
          console.log("ä¸æ­£è§£éŸ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒ©ãƒ¼:", e);
        }
      }
    } catch (e) {
      console.log("éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼:", e);
    }
  };
  
  // ãƒã‚¤ãƒ†ã‚£ãƒ–å´ã«ã‚²ãƒ¼ãƒ é–‹å§‹ã‚’é€šçŸ¥
  const notifyGameStart = () => {
    try {
      if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.gameStart) {
        window.webkit.messageHandlers.gameStart.postMessage('start');
      }
    } catch (e) {
      console.log("ã‚²ãƒ¼ãƒ é–‹å§‹é€šçŸ¥ã‚¨ãƒ©ãƒ¼:", e);
    }
  };
  
  // ãƒã‚¤ãƒ†ã‚£ãƒ–å´ã«ã‚²ãƒ¼ãƒ çµ‚äº†ã‚’é€šçŸ¥
  const notifyGameEnd = () => {
    try {
      if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.gameEnd) {
        window.webkit.messageHandlers.gameEnd.postMessage({score: score});
      }
    } catch (e) {
      console.log("ã‚²ãƒ¼ãƒ çµ‚äº†é€šçŸ¥ã‚¨ãƒ©ãƒ¼:", e);
    }
  };
  
  // æ®‹ã‚Šãƒ—ãƒ¬ã‚¤å›æ•°ã‚’è¡¨ç¤º
  window.updateRemainingPlays = (count, isAdFree) => {
    if (isAdFree) {
      remainingPlays.textContent = "åºƒå‘Šéè¡¨ç¤ºè³¼å…¥æ¸ˆã¿";
      purchaseBtn.style.display = "none";
      storeContainer.style.display = "block";
    } else if (count > 0) {
      remainingPlays.textContent = `æ®‹ã‚Šç„¡æ–™ãƒ—ãƒ¬ã‚¤å›æ•°: ${count}å›`;
      purchaseBtn.style.display = "block";
      storeContainer.style.display = "block";
    } else {
      remainingPlays.textContent = "ç„¡æ–™ãƒ—ãƒ¬ã‚¤çµ‚äº† - 3å›ã«1å›åºƒå‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™";
      purchaseBtn.style.display = "block";
      storeContainer.style.display = "block";
    }
  };
  
  // è³¼å…¥å‡¦ç†
  purchaseBtn.addEventListener('click', () => {
    try {
      if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.purchase) {
        window.webkit.messageHandlers.purchase.postMessage('removeAds');
      }
    } catch (e) {
      console.log("è³¼å…¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:", e);
    }
  });
  
  // è³¼å…¥å¾©å…ƒå‡¦ç†
  restoreBtn.addEventListener('click', () => {
    try {
      if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.restore) {
        window.webkit.messageHandlers.restore.postMessage('restore');
      }
    } catch (e) {
      console.log("è³¼å…¥å¾©å…ƒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:", e);
    }
  });
  
  // ãƒ€ãƒŸãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
  const correctAudio = { type: 'correct' };
  const wrongAudio = { type: 'wrong' };

  const loadLB = () => { 
    try {
      const data = localStorage.getItem(LB_KEY);
      return data ? JSON.parse(data) : [];
    } catch(e) {
      console.log('Loading leaderboard failed:', e);
      return [];
    }
  };
  
  const saveLB = arr => {
    try {
      localStorage.setItem(LB_KEY, JSON.stringify(arr));
    } catch(e) {
      console.log('Saving leaderboard failed:', e);
    }
  };
  
  const renderLB = () => {
    try {
      lbList.innerHTML='';
      loadLB().forEach(e=> {
        const li=document.createElement('li');
        li.textContent = `${e.name} â‹¯ ${e.score} ç‚¹`;
        lbList.appendChild(li);
      });
    } catch(e) {
      console.log('Rendering leaderboard failed:', e);
    }
  };

  function startGame() {
    // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ãŒã™ã§ã«æŠ¼ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ä½•ã‚‚ã—ãªã„
    if (startButtonClicked) return;
    
    startButtonClicked = true;
    score = 0;
    peopleNum = 8;
    reactTimes = [];
    gameActive = true; // ã‚²ãƒ¼ãƒ é–‹å§‹
    scoreEl.textContent = 'ã‚¹ã‚³ã‚¢: 0';
    timerEl.style.visibility = 'visible';
    document.getElementById('ranking').style.display = 'none';
    nameInputContainer.style.display = 'none';
    storeContainer.style.display = 'none';
    
    // ãƒã‚¤ãƒ†ã‚£ãƒ–å´ã«ã‚²ãƒ¼ãƒ é–‹å§‹ã‚’é€šçŸ¥
    notifyGameStart();
    
    // å°‘ã—é…å»¶ã•ã›ã¦ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ï¼ˆã‚¿ãƒƒãƒ—èª¤æ¤œçŸ¥é˜²æ­¢ï¼‰
    setTimeout(() => {
      nextQuestion();
    }, 300);
  }

  function nextQuestion() {
    if (!gameActive) return; // ã‚²ãƒ¼ãƒ ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§ãªã‘ã‚Œã°ä½•ã‚‚ã—ãªã„
    
    lineEl.innerHTML = '';
    optionsEl.innerHTML = '';
    targetIndex = Math.floor(Math.random() * peopleNum);
    
    const animals = ['ğŸ¼','ğŸ®','ğŸ·','ğŸ¥'];
    const numAnimals = Math.floor(score / 5);
    const animalIndices = new Set();
    while (animalIndices.size < numAnimals) {
      const idx = Math.floor(Math.random() * peopleNum);
      if (idx !== targetIndex) animalIndices.add(idx);
    }
    let animalCount = 0;
    
    // 12äººã”ã¨ã«æŠ˜ã‚Šè¿”ã™ãŸã‚ã®ãƒ­ã‚¸ãƒƒã‚¯
    const numRows = Math.ceil(peopleNum / 12);
    for (let row = 0; row < numRows; row++) {
      // å„è¡Œã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ
      const rowDiv = document.createElement('div');
      rowDiv.className = 'row';
      
      // å„è¡Œã«12äººã¾ã§é…ç½®
      const startIdx = row * 12;
      const endIdx = Math.min(startIdx + 12, peopleNum);
      
      for (let i = startIdx; i < endIdx; i++) {
        const div = document.createElement('span');
        div.className = 'person';
        if (i === targetIndex) {
          div.textContent = 'ğŸ™‹â€â™€ï¸';
          // ãƒã‚¤ãƒ©ã‚¤ãƒˆåŠ¹æœã ã‘é©ç”¨
          div.style.textShadow = '0 0 5px #ffcc00';
        } else if (animalIndices.has(i)) {
          div.textContent = animals[animalCount % animals.length];
          animalCount++;
        } else {
          div.textContent = 'ğŸ‘¨';
        }
        rowDiv.appendChild(div);
      }
      
      lineEl.appendChild(rowDiv);
    }
    
    // lineElãŒç”»é¢ã‹ã‚‰ã¯ã¿å‡ºã‚‹å ´åˆã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«ã™ã‚‹
    if (lineEl.scrollHeight > window.innerHeight * 0.5) {
      lineEl.style.maxHeight = '50vh';
      lineEl.style.overflowY = 'auto';
      lineEl.style.webkitOverflowScrolling = 'touch';
    } else {
      lineEl.style.maxHeight = '';
      lineEl.style.overflowY = '';
      lineEl.style.webkitOverflowScrolling = '';
    }
    
    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ãƒªã‚»ãƒƒãƒˆ
    lineEl.scrollTop = 0;
    
    const correct = targetIndex + 1;
    const opts = new Set([correct]);
    while (opts.size < 4) {
      const offset = Math.floor(Math.random() * 11) - 5;
      const n = correct + offset;
      if (n >= 1 && n <= peopleNum) opts.add(n);
    }
    [...opts].sort((a, b) => a - b).forEach(n => {
      const btn = document.createElement('button');
      btn.className = 'optBtn';
      btn.textContent = n;
      // ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
      btn.addEventListener('click', () => {
        if (!gameActive) return; // ã‚²ãƒ¼ãƒ ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§ãªã‘ã‚Œã°ä½•ã‚‚ã—ãªã„
        
        clearInterval(timerId);
        const rt = 10 - timeLeft;
        
        if (n === correct) {
          play(correctAudio);
          score++;
          reactTimes.push(rt);
          scoreEl.textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
          peopleNum += 2;
          setTimeout(nextQuestion, 300);
        } else {
          play(wrongAudio);
          endGame();
        }
      });
      optionsEl.appendChild(btn);
    });
    timeLeft = 10;
    updateTimer();
    if (timerId) clearInterval(timerId);
    timerId = setInterval(() => {
      if (!gameActive) {
        clearInterval(timerId);
        return;
      }
      
      timeLeft -= 0.1;
      if (timeLeft <= 0) {
        clearInterval(timerId);
        play(wrongAudio);
        endGame();
      }
      updateTimer();
    }, 100);
  }

  function updateTimer() {
    timerEl.textContent = `ã®ã“ã‚Šã˜ã‹ã‚“ ${timeLeft.toFixed(1)}ç§’`;
  }

  function endGame() {
    if (!gameActive) return;
    
    gameActive = false; // ã‚²ãƒ¼ãƒ çµ‚äº†
    startButtonClicked = false; // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ
    clearInterval(timerId);
    timerId = null;
    
    optionsEl.innerHTML = '';
    timerEl.style.visibility = 'hidden';
    
    // ãƒã‚¤ãƒ†ã‚£ãƒ–å´ã«ã‚²ãƒ¼ãƒ çµ‚äº†ã‚’é€šçŸ¥
    notifyGameEnd();
    
    if (score > 0) {
      nameInputContainer.style.display = 'block';
      playerNameInput.value = localStorage.getItem(LASTNAME_KEY) || '';
      playerNameInput.focus();
    } else {
      document.getElementById('ranking').style.display = 'block';
      document.getElementById('startBtn').style.display = '';
      storeContainer.style.display = 'block';
    }
  }

  function submitScore() {
    const name = playerNameInput.value.trim();
    if(name){
      localStorage.setItem(LASTNAME_KEY, name);
      const avg = reactTimes.length ? reactTimes.reduce((a,b)=>a+b,0)/reactTimes.length : 0;
      const lb = loadLB();
      lb.push({name, score: score, avg: avg});
      lb.sort((a, b) => b.score - a.score);
      if(lb.length > 10) lb.length = 10;
      saveLB(lb);
      renderLB();
    }
    nameInputContainer.style.display = 'none';
    document.getElementById('ranking').style.display = 'block';
    document.getElementById('startBtn').style.display = '';
    storeContainer.style.display = 'block';
  }

  submitNameBtn.addEventListener('click', submitScore);
  playerNameInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') submitScore();
  });

  document.getElementById('resetBtn').addEventListener('click', () => {
    const pw = prompt("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š");
    if (pw === '0000') {
      localStorage.removeItem(LB_KEY);
      renderLB();
      alert("ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚");
    } else if (pw !== null) {
      alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚");
    }
  });

  // ãƒšãƒ¼ã‚¸ã®å¯è¦–æ€§å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›£è¦–
  document.addEventListener('visibilitychange', () => {
    if (document.hidden && gameActive) {
      // ãƒšãƒ¼ã‚¸ãŒéè¡¨ç¤ºã«ãªã£ãŸã‚‰ã‚²ãƒ¼ãƒ ã‚’ä¸€æ™‚åœæ­¢
      clearInterval(timerId);
    } else if (!document.hidden && gameActive) {
      // ãƒšãƒ¼ã‚¸ãŒå†è¡¨ç¤ºã•ã‚ŒãŸã‚‰ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹
      if (timerId) clearInterval(timerId);
      timerId = setInterval(() => {
        timeLeft -= 0.1;
        if (timeLeft <= 0) {
          clearInterval(timerId);
          play(wrongAudio);
          endGame();
        }
        updateTimer();
      }, 100);
    }
  });
  
  // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
  startBtn.addEventListener('click', function(e) {
    // ã‚¤ãƒ™ãƒ³ãƒˆãŒä¼æ’­ã—ãªã„ã‚ˆã†ã«ã™ã‚‹
    e.preventDefault();
    e.stopPropagation();
    
    startBtn.style.display = 'none';
    startGame();
    
    // èª¤ã‚¿ãƒƒãƒ—é˜²æ­¢ã®ãŸã‚ã«falseã‚’è¿”ã™
    return false;
  });

  renderLB();
  
  // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒã‚¤ãƒ†ã‚£ãƒ–å´ã«åˆæœŸåŒ–å®Œäº†ã‚’é€šçŸ¥
  try {
    if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.pageLoaded) {
      window.webkit.messageHandlers.pageLoaded.postMessage('loaded');
    }
  } catch (e) {
    console.log("ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰é€šçŸ¥ã‚¨ãƒ©ãƒ¼:", e);
  }
})();
</script>
</body>
</html>